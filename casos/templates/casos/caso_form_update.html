<!-- casos/templates/casos/caso_form_update.html -->
{% extends 'core/base.html' %}

{% block title %}Editar Caso #{{ form.instance.pk }}{% endblock %}
{% block page_title %}Editar Caso: {{ form.instance.titulo_caso }}{% endblock %}

{% block content %}
<div class="card">
    <div class="card-body">
        <form method="post">
            {% csrf_token %}
            {% if form.errors %}<div class="alert alert-danger">{{ form.errors }}</div>{% endif %}

            <!-- CAIXA DE DESTAQUE DA FASE ATUAL -->
            {% if form.instance.fase_atual_workflow %}
            <div class="alert alert-primary d-flex align-items-center" role="alert">
                <i class="bi bi-diagram-3-fill me-3 fs-4"></i>
                <div><h6 class="alert-heading mb-0">Fase Atual do Workflow</h6><strong>{{ form.instance.fase_atual_workflow.nome }}</strong></div>
            </div>
            {% endif %}

            <!-- SEÇÃO DE CAMPOS FIXOS (COM ADVOGADO NO LUGAR CERTO) -->
            <h5 class="mt-3 border-bottom pb-2">Informações Principais</h5>
            <div class="row g-3">
                <div class="col-12"><label for="{{ form.titulo_caso.id_for_label }}" class="form-label">{{ form.titulo_caso.label }}</label>{{ form.titulo_caso }}</div>
                <div class="col-md-6"><label for="{{ form.cliente.id_for_label }}" class="form-label">{{ form.cliente.label }}</label>{{ form.cliente }}</div>
                <div class="col-md-6"><label for="{{ form.produto.id_for_label }}" class="form-label">{{ form.produto.label }}</label>{{ form.produto }}</div>
                <div class="col-md-6"><label for="{{ form.status.id_for_label }}" class="form-label">{{ form.status.label }}</label>{{ form.status }}</div>
                <div class="col-md-6"><label for="{{ form.advogado_responsavel.id_for_label }}" class="form-label">{{ form.advogado_responsavel.label }}</label>{{ form.advogado_responsavel }}</div>
                <div class="col-md-6"><label for="{{ form.data_entrada_rca.id_for_label }}" class="form-label">{{ form.data_entrada_rca.label }}</label>{{ form.data_entrada_rca }}</div>
                <div class="col-md-6"><label for="{{ form.data_encerramento.id_for_label }}" class="form-label">{{ form.data_encerramento.label }}</label> {{ form.data_encerramento }}</div>
            </div>

            <!-- SEÇÃO DE CAMPOS DINÂMICOS E OPCIONAIS -->
            <h5 class="mt-4 border-bottom pb-2">Informações Adicionais</h5>
            <div class="row g-3">
                {% for field in form %}
                    {% if field.name|stringformat:"s"|slice:":8" == "dynamic_" %}
                        <div class="col-md-6"><label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>{{ field }}{% if field.errors %}<div class="invalid-feedback d-block">{{ field.errors|striptags }}</div>{% endif %}</div>
                    {% endif %}
                {% endfor %}
            </div>

            <div class="mt-4">
                <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                <a href="{% url 'casos:caso_detail' form.instance.pk %}" class="btn btn-secondary">Cancelar</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}